
(function(){function p(a){var b={},d=new a.HistoryHTML5;d.on("change",function(c){if(c.src===a.HistoryHTML5.SRC_POPSTATE){l=!0;var b=c.changed.state;b?f.RefreshSources(b.newVal):(c.halt(!0),window.history.go(-1));l=!1}});return{enabled:!0,addState:function(a,b,q){d[q?"replace":"add"]({state:b},{url:h.getCurrentPage()+a})},checkCache:function(a){return a in b?b[a]:null},setCache:function(a,d){b[a]=d}}}var k,n,h,f,l=!1;RightNow.ParameterContext={};"pushState"in window.history?YUI().use("history-html5",function(a){k=p(a)}):k={enabled:!1};n=function(){function a(a,b){this.sourceCollection[b.sourceID]={response:a,filters:b.filters,sourceID:b.sourceID};this.completedSearches++;k.setCache(b.sourceID+b.historyKey,this.sourceCollection[b.sourceID]);this.completedSearches===this.sourceCount&&(f.RefreshSources(this.sourceCollection),k.addState(b.historyKey,this.sourceCollection,b.isRestoring),this.completedSearches=0,this.sourceCollection={})}function b(b,c,d){RightNow.Ajax.makeRequest(b,c,{successHandler:a,failureHandler:function(a){var b=RightNow.Interface.getMessage("THERE_PROB_REQ_ACTION_COULD_COMPLETED_MSG");403===a.status&&void 0!==a.responseText&&(b=a.responseText);RightNow.UI.Dialog.messageDialog(b,{icon:"WARN",exitCallback:function(){window.location.reload(!0)}})},json:!0,data:d,timeout:1E4})}function d(a,c,d,g,r){this.sourceCount=g;g=h.getFilterUrl(a);var m=k.checkCache(d+g);if("/"===g)r.fire("response",new RightNow.Event.EventObject(null,{data:{}}));else if(g=RightNow.Url.addParameter(g,"session",RightNow.Url.getSession()),m)this.completedSearches++,this.sourceCollection[m.sourceID]=m,this.completedSearches===this.sourceCount&&(f.RefreshSources(this.sourceCollection),k.addState(g,this.sourceCollection,l),this.completedSearches=0,this.sourceCollection={});else{if(!c.endpoint)throw Error("An endpoint hasn't been specified");b(c.endpoint,e.mix({sourceID:d,filters:RightNow.JSON.stringify(a),limit:c.limit},c.params),{sourceID:d,historyKey:g,filters:a,isRestoring:l})}}function c(a,b){if(!this.refreshInProgress){var c=RightNow.Url.addParameter((b.new_page||h.getCurrentPage())+h.getFilterUrl(a),"session",RightNow.Url.getSession());"_self"===b.target?RightNow.Url.navigate(c,!0):window.open(c,b.target||"_self");this.refreshInProgress=!0}}var e=YUI();this.completedSearches=this.sourceCount=0;this.sourceCollection={};return{go:function(a,b,e,g,f){!k.enabled||b&&(b.new_page||!b.endpoint)?c(a,b):d(a,b,e,g,f)}}}();h={alphanumericSort:function(a,b){return a<b?-1:a>b?1:0},getFilterUrl:function(a){var b=[],d={},c,e;for(c in a)a.hasOwnProperty(c)&&(e=a[c],!e.key||d[e.key]||!e.value&&0!==e.value&&!1!==e.value||(b.push(e.key),d[e.key]=e.value));b.sort(h.alphanumericSort);for(a="";c=b.shift();)a+="/"+c+"/"+encodeURIComponent(d[c]);return a},getFlattenedFilters:function(a){var b={},d,c;for(c in a)a.hasOwnProperty(c)&&"object"===typeof a[c]&&(d=h.getFlattenedFilter(a[c]))&&(b[c]=d);return b},getWidgetData:function(a){var b={};a&&a.data&&(b.w_id=a.w_id,b.rn_contextData=a.data.rn_contextData,b.rn_contextToken=a.data.rn_contextToken,b.rn_timestamp=a.data.rn_timestamp,b.rn_formToken=a.data.rn_formToken);return b},getFlattenedFilter:function(a){if("value"in a&&"type"in a&&"key"in a)return{value:a.value,key:a.key,type:a.type}},getCurrentPage:function(){var a=window.location,b=a.pathname,a=a.origin||a.protocol+"//"+a.host;return"/"===b||"/app"===b||"/app/"===b?a+"/app/"+RightNow.Interface.getConfig("CP_HOME_URL"):b.split("/").slice(0,RightNow.Url.getParameterSegment()-1).join("/")}};f=function(){function a(a){return a?c[a]:c}function b(a){if(!a||!a.length||2>a.length)throw Error("You're doing it wrong");this.sources=a;this.multiple=!0}function d(a){return function(){for(var b=0,c=arguments,g;b<this.sources.length;b++)g=this.sources[b],g[a].apply(g,c);return this}}var c={},e=RightNow.EventProvider.extend({overrides:{constructor:function(a,b,d){this.parent();this.sourceID=b;this.Y=a;this.initialFilters={};this.filters={};this.widgetData={};this.options={};this.cancelSearch=!1;delete this.data;delete this.baseDomID;delete this.baseSelector;this._addEventHandler("collect",{pre:function(){this.filters=this.initialFilters},during:function(a){a&&a instanceof RightNow.Event.EventObject&&((a=h.getFlattenedFilter(a.data))&&a.value?this.filters[a.type]=a:delete this.filters[a.type])}});this._addEventHandler("search",{pre:function(b){if(RightNow.isInstance(b,RightNow.Event.EventObject)){var c=this.options.limit!==b.data.limit?this.options.limit:null;this.options=a.merge(this.options,b.data);c&&(this.options.limit=c)}this.options.params=a.merge(this.options.params,this.widgetData);"page"in this.options&&(this.Y.Object.isEmpty(this.filters)&&(this.filters=this.initialFilters),this.filters.page=this.options.page);this.cancelSearch=!1},during:function(a){!1===a&&(this.cancelSearch=!0)},post:function(){this.cancelSearch?this.fire("searchCancelled",this.filters,this.options):n.go(this.filters,this.options,b,this.options.sourceCount||Object.keys(c).length,this);delete this.options.sourceCount}});this._addEventHandler("initializeFilters",{pre:function(b){if(RightNow.isInstance(b,RightNow.Event.EventObject)&&(RightNow.ParameterContext[this.instanceID]=this.initialFilters=h.getFlattenedFilters(b.data),this.widgetData=h.getWidgetData(b),k.enabled&&(b=Object.keys(c),b[b.length-1]===this.instanceID))){b={};for(var d in RightNow.ParameterContext)b=a.merge(b,RightNow.ParameterContext[d]);var e=h.getFilterUrl(b),f={},e=RightNow.Url.addParameter(e,"session",RightNow.Url.getSession());this.Y.Object.each(c,function(a,b){var c=this.Y.one("#rn_"+a.widgetData.w_id+"_HistoryData"),d=this.Y.one("#rn_"+a.widgetData.w_id+"_Content");c&&d&&(c=JSON.parse(c.getHTML()),c.html=d.getHTML(),c._isParsed=!0,f[b]={response:c,filters:this.initialFilters,sourceID:b},k.setCache(e+b,f[b]))},this);k.addState(e,f,!0)}}});this._addEventHandler("updateHistoryEntry",{pre:function(b){if(k.enabled&&b&&b instanceof RightNow.Event.EventObject){this.options=a.merge(this.options,b.data.data);this.options.params=a.merge(this.options.params,this.widgetData);"page"in this.options&&(this.Y.Object.isEmpty(this.filters)&&(this.filters=this.initialFilters),this.filters.page=this.options.page);for(var c in b.data.update)this.filters[c]=b.data.update[c];b=h.getFilterUrl(this.filters);b=RightNow.Url.addParameter(b,"session",RightNow.Url.getSession());k.addState(b,null,!0)}}});this._addEventHandler("updateFilters");this._addEventHandler("reset");this.on("reset",function(){this.filters=this.initialFilters;this.page=0},this)},setOptions:function(a){a&&this.sourceID in a&&a[this.sourceID]&&(a=a[this.sourceID]);this.options=this.Y.mix(this.options,a,!0);return this}}});b.prototype={on:d("on"),fire:d("fire"),setOptions:d("setOptions")};return{SearchSource:e,MultipleSourcesWrapper:b,RefreshSources:function(b){var c,d;for(d in b)b.hasOwnProperty(d)&&(c=a(d))&&c.fire("response",new RightNow.Event.EventObject(null,{data:b[d].response})).fire("updateFilters",new RightNow.Event.EventObject(null,{data:b[d].filters}))},get:a,getSearchSources:function(a){return a?(a+"").split(","):[]},add:function(a,b){if(a&&RightNow.isInstance(b,e)&&!c[a])return c[a]=b}}}();RightNow.SearchConsumer=RightNow.Widgets.extend({constructor:function(){var a=f.getSearchSources(this.data.attrs.source_id),b=f.get(a[0]);1<a.length&&RightNow.UI.DevelopmentHeader.addJavascriptError("A search consumer cannot have more than one search source");b||(b=new f.SearchSource(this.Y,a[0]),f.add(a[0],b));this.searchSource=function(){return b}}});RightNow.SearchProducer=RightNow.Widgets.extend({constructor:function(){for(var a=f.getSearchSources(this.data.attrs.source_id),b=[],d=0,c;d<a.length;d++)c=c=f.get(a[d]),c||(c=new f.SearchSource(this.Y,a[d]),f.add(a[d],c)),b.push(c);if(!b.length)throw Error("No search sources were given");c=1===b.length?c:new f.MultipleSourcesWrapper(b);this.searchSource=function(){return c}}})})();
RightNow.Widgets.SourceSearchField=RightNow.SearchProducer.extend({overrides:{constructor:function(){this.parent();this.input=this.Y.one(this.baseSelector+'_SearchInput');if(this.data.attrs.initial_focus){this.input.focus();}
this.searchSource().on('collect',this.onCollect,this).on('updateFilters',this.onFilterUpdate,this).on('reset',this.onReset,this);RightNow.Event.subscribe('evt_getSearchField',function(){RightNow.Event.fire("evt_sendSearchField",new RightNow.Event.EventObject(this,{data:this.input}));},this);}},onCollect:function(){var searchTerm="";var keywordEntered=this.Y.Lang.trim(this.input.get('value'));if(this.data.attrs.allow_empty_search&&!keywordEntered){searchTerm="*";}
else if(keywordEntered){searchTerm=keywordEntered;}
this.searchSource().setOptions({page:{key:"page",type:"page",value:1}});return new RightNow.Event.EventObject(this,{data:this.Y.merge(this.data.js.filter,{value:searchTerm})});},onFilterUpdate:function(e,eo){this.Y.Object.some(eo[0].data,function(filter){if(filter.key===this.data.js.filter.key){var filterValue=this.Y.Node.create('<textarea>'+filter.value+'</textarea>').get('innerText');this.input.set('value',(filter.value!=='*')?filterValue:'');return true;}},this);},onReset:function(){this.input.set('value',this.data.js.prefill);}});
RightNow.Widgets.SourceSearchButton=RightNow.SearchProducer.extend({overrides:{constructor:function(){this.parent();this.searchButton=this.Y.one(this.baseSelector+"_SubmitButton");RightNow.Event.subscribe("evt_sendSearchField",function(evt,evtData){this.searchField=evtData[0].data;this.search();},this);if(this.searchButton){this.enableClickListener();this.searchSource().setOptions(this.searchOptions()).setOptions(this.data.js.sources).on('response',this.enableClickListener,this);}}},searchOptions:function(){return this._searchOptions||(this._searchOptions={new_page:this.data.attrs.search_results_url,target:this.data.attrs.target,limit:this.data.attrs.per_page});},search:function(e){if(e)
e.halt();if(!this.searchField){RightNow.Event.fire("evt_getSearchField",new RightNow.Event.EventObject(this));return;}
if(this.searchInProgress)return;this.searchSource().fire('collect');if(this.searchSource().multiple){this.filters=this.searchSource().sources[0].filters;}
else{this.filters=this.searchSource().filters;}
if(this.filters.query&&this.Y.Lang.trim(this.filters.query.value)!==''){if(this.filters.query.key==="kw"&&this.Y.Lang.trim(this.filters.query.value)==="*"){this.filters.direction=this.filters.direction||{};this.filters.direction.value=0;this.filters.sort=this.filters.sort||{};this.filters.sort.value=1;}
this.disableClickListener();this.searchSource().fire('search',new RightNow.Event.EventObject(this,{data:this.searchOptions()}));}
else{RightNow.UI.displayBanner(this.data.attrs.label_enter_search_keyword,{type:'WARNING',focusElement:this.searchField});}},enableClickListener:function(evt){this.searchInProgress=false;this.searchButton.set('disabled',false).on('click',this.search,this);if(evt){this.searchButton.focus();}},disableClickListener:function(){this.searchInProgress=true;this.searchButton.set('disabled',true).detach('click',this.search,this);}});
RightNow.Widgets.VisualProductCategorySelector=RightNow.Widgets.extend({constructor:function(){this.widgetElement=this.Y.one(this.baseSelector);this.paginationNode=this.widgetElement.one('.rn_ItemPagination');this.currentLevel=0;this.itemLevels=[];if(this.data.attrs.prefetch_sub_items_non_ajax&&!this.data.attrs.prefetch_sub_items){this.prefetched=this.data.js.subItems;}
else{this.prefetched={};}
if(this.widgetElement){this._displayInitialItemSet(this.data.js.items);this._attachEventHandlers(this.widgetElement,[['click','a.rn_ShowChildren',this._onShowChildrenClick],['click','a.rn_BreadCrumbLink',this._goToPreviousLevel],['click','a.rn_ForwardPage',this._goForwardPage],['click','a.rn_PreviousPage',this._goPreviousPage]]);}},_getVisibleNodes:function(nodeList){return nodeList.filter(function(node){return node.className.search(/rn_Hidden/g)===-1;});},_onShowChildrenClick:function(e){e.halt();var target=e.target,id=parseInt(target.getAttribute('data-id'),10),el=target.ancestor('.rn_ItemGroup'),label=this.Y.Lang.trim(target.ancestor('.rn_VisualItemContainer > .rn_ActionContainer').one('.rn_ItemLink').get('text'));if(!isNaN(id)){this._showChildren({id:id,label:label,el:el});}},_showChildren:function(parent){var subItemsAlreadyRendered=this._showSubItemsFor(parent.id);if(subItemsAlreadyRendered){this._setCurrentItemLevel(parent);this._updateBreadCrumb(this.currentLevel,this.itemLevels);}
else if(parent.id in this.prefetched){this._setCurrentItemLevel(parent);this._insertNewGroupAtCurrentLevel(this.prefetched[parent.id]);}
else if(this.requestChildren(parent.id,this._childrenResponse)){this._toggleLoading(true);this._setCurrentItemLevel(parent);}},requestChildren:function(id,callback){var eo=new RightNow.Event.EventObject(this,{data:{id:id,filter:this.data.attrs.type,linking:false}});if(!RightNow.Event.fire('evt_ItemRequest',eo))return false;RightNow.Ajax.makeRequest(this.data.attrs.sub_item_ajax,eo.data,{json:true,scope:this,data:eo,successHandler:callback});return true;},_childrenResponse:function(response,origEventObject){if(!response||!RightNow.Event.fire('evt_ItemResponse',{data:origEventObject,response:response}))return;this._insertNewGroupAtCurrentLevel(response.result[0]);},_insertNewGroupAtCurrentLevel:function(items){var previousLevel=this.itemLevels[this.currentLevel-1]||{};this._showNewGroup(items,this.Y.mix(previousLevel,{level:this.currentLevel+1,focusOnFirst:true}));},_showNewGroup:function(items,options){if(items.length>this.data.attrs.maximum_items){items=items.slice(0,this.data.attrs.maximum_items);}
var newItemGroup=this._renderNewItemGroup(items,options.level,options.id);this._hide(this.widgetElement.all('.rn_ItemGroup'));this.widgetElement.one('.rn_Items').append(newItemGroup);this._replaceBrokenImages(newItemGroup);this._normalizeDescriptionHeights(newItemGroup);this._setPaginationVisibility(newItemGroup);this._updateBreadCrumb(this.currentLevel,this.itemLevels);if(this.data.attrs.per_page>0){this._paginateItems(newItemGroup,options);}
if(this.data.attrs.prefetch_sub_items&&!this.data.attrs.prefetch_sub_items_non_ajax){this._prefetchSubItems(items);}
else if(this.data.attrs.prefetch_sub_items_non_ajax&&!this.data.attrs.prefetch_sub_items){if(options.level>1){this._prefetchSubItems(items);}
else{this._setShowMoreNumber(this.prefetched);}}
else if(this.data.attrs.prefetch_sub_items_non_ajax&&this.data.attrs.prefetch_sub_items){RightNow.UI.displayBanner(this.data.attrs.label_error,{type:'ERROR'});}
this._toggleLoading(false);this._updateAriaAlert(this.data.attrs.label_screen_reader_new_results);if(options.focusOnFirst){this._focusFirstLink(newItemGroup);}},_setCurrentItemLevel:function(item){this.itemLevels[this.currentLevel++]={id:item.id,el:item.el,label:item.label};},_setShowMoreNumber:function(items){this.Y.Object.each(items,function(items,parentID){if(showMoreLink=this.Y.one(this.baseSelector+' .rn_ShowChildren[data-id="'+parentID+'"]')){showMoreLink.set('text',RightNow.Text.sprintf(this.data.attrs.label_prefetched_sub_items,this.prefetched[parentID].length));}},this);},_getCurrentPageNumber:function(itemsPerPage,items){var itemGroupPass=0,pageNumber;items.some(function(node,index){if(index%itemsPerPage===0){++itemGroupPass;if(!node.hasClass('rn_Hidden')){pageNumber=itemGroupPass;return true;}}});return pageNumber;},_hideShowItemsForPagination:function(pageNumber,itemsPerPage,items){var visibleItemUpperIndex=(itemsPerPage*pageNumber)-1,visibleItemLowerIndex=visibleItemUpperIndex-itemsPerPage;items.each(function(node,index){if(index>visibleItemLowerIndex&&index<=visibleItemUpperIndex){node.removeClass('rn_Hidden');}
else{node.addClass('rn_Hidden');}});},_setButtonDisabledClass:function(pageNumber,itemsPerPage,itemsCount,container){var forwardButton=this.Y.one(this.baseSelector+' a.rn_ForwardPage'),forwardButtonSpan=forwardButton.one('span.rn_ScreenReaderOnly'),previousButton=this.Y.one(this.baseSelector+' a.rn_PreviousPage'),previousButtonSpan=previousButton.one('span.rn_ScreenReaderOnly'),attrs=this.data.attrs;if(pageNumber===Math.ceil(itemsCount/itemsPerPage)){if(attrs.numbered_pagination){forwardButton.addClass('rn_Hidden');}
else{forwardButton.addClass('rn_Disabled').setAttribute('tabIndex','-1');forwardButtonSpan.setContent(attrs.label_screen_reader_forward_page_disabled);}}
else{if(attrs.numbered_pagination){forwardButton.removeClass('rn_Hidden');}
else{forwardButton.removeClass('rn_Disabled').removeAttribute('tabIndex');forwardButtonSpan.setContent(attrs.label_screen_reader_forward_page);}}
if(pageNumber===1){if(attrs.numbered_pagination){previousButton.addClass('rn_Hidden');}
else{previousButton.addClass('rn_Disabled').setAttribute('tabIndex','-1');previousButtonSpan.setContent(attrs.label_screen_reader_previous_page_disabled);}}
else{if(attrs.numbered_pagination){previousButton.removeClass('rn_Hidden');}
else{previousButton.removeClass('rn_Disabled').removeAttribute('tabIndex');previousButtonSpan.setContent(attrs.label_screen_reader_previous_page);}}
if(attrs.numbered_pagination){this._renderPagedPagination(pageNumber,itemsPerPage,itemsCount,forwardButton);}},_renderPagedPagination:function(pageNumber,itemsPerPage,itemsCount,forwardButton){var pageCount=Math.ceil(itemsCount/itemsPerPage),forwardButtonListItem=forwardButton.ancestor();if(pageCount>1){var stalePageLinks=this.Y.all(this.baseSelector+' .rn_ItemPagination li:not(:first-child):not(:last-child)');if(stalePageLinks.size()>0){stalePageLinks.remove(true);}
for(var i=1;i<pageCount+1;i++){var pageLinkListItem=this.Y.Node.create('<li><a href="javascript:void(0);">'+i+'</a></li>'),pageLink=pageLinkListItem.one('a'),pageTitle=RightNow.Text.sprintf(this.data.attrs.label_page,pageNumber,pageCount);pageLink.setAttribute('title',pageTitle);pageLink.setAttribute('aria-label',pageTitle);if(i===pageNumber){pageLink.addClass('rn_CurrentPage');}
else{pageLink.on('click',this._goSpecificPage,this)}
forwardButtonListItem.insertBefore(pageLinkListItem,forwardButtonListItem);}}},_paginateItems:function(container,options){var itemsPerPage=this.data.attrs.per_page,items=container.all('.rn_Item'),itemsCount=items.size();if(itemsCount<=itemsPerPage){return;}
var pageNumber=this._getCurrentPageNumber(itemsPerPage,items),directionOrPage=options.direction;if(directionOrPage){if(!isNaN(directionOrPage)){pageNumber=directionOrPage;}
else{(directionOrPage==='forward')?pageNumber++:pageNumber--;}}
this._hideShowItemsForPagination(pageNumber,itemsPerPage,items);if(!options.isInitialLoad){this._focusFirstLink(this._getVisibleNodes(items).item(0));}
this._setButtonDisabledClass(pageNumber,itemsPerPage,itemsCount,container);this.widgetElement.one('.rn_ItemPagination').removeClass('.rn_Hidden');},_goToPreviousLevel:function(e){var id=parseInt(e.target.getAttribute('data-id'),10);if(!this._showSubItemsFor(id)){this._showChildren({id:isNaN(id)?this.itemLevels[0].id:id});}
this.currentLevel=parseInt(e.target.getAttribute('data-level'),10);if(!this.data.attrs.label_breadcrumb){this.currentLevel++;}
this._updateBreadCrumb(this.currentLevel,this.itemLevels);},_paginateItemSet:function(e,direction){e.halt();if(!e.currentTarget.hasClass('rn_Disabled')){var itemGroupContainer=this._getVisibleNodes(this.widgetElement.all('.rn_ItemGroup')).item(0);this._paginateItems(itemGroupContainer,{direction:direction});}},_goPreviousPage:function(e){this._paginateItemSet(e,'previous');},_goForwardPage:function(e){this._paginateItemSet(e,'forward');},_goSpecificPage:function(e){this._paginateItemSet(e,parseInt(e.target.get('text'),10));},_toggleLoading:function(show){if(!this._loadingIndicator){this._loadingIndicator=this.Y.Node.create('<div class="rn_Loading rn_Hidden"></div>');this.widgetElement.one('.rn_Items').prepend(this._loadingIndicator);}
document.body.setAttribute('aria-busy',show+'');this._loadingIndicator.toggleClass('rn_Hidden',!show);},_displayInitialItemSet:function(items){var id,level=0;this._toggleLoading(true);this._showNewGroup(items,{id:id,level:++level,focusOnFirst:this.data.attrs.initial_focus,isInitialLoad:true});},_showSubItemsFor:function(id){var existing=(typeof id==='number')?this.widgetElement.one(this.baseSelector+'_'+(id||'Base')+'_SubItems'):id;if(existing){this.widgetElement.all('.rn_ItemGroup').addClass('rn_Hidden');this._setPaginationVisibility(existing);this._focusFirstLink(existing.removeClass('rn_Hidden'));return true;}
return false;},_prefetchSubItems:function(items){var ids=[];this.Y.Array.each(items,function(item){if(item.hasChildren){ids.push(item.id);}},this);var eo=new RightNow.Event.EventObject(this,{data:{items:ids.join(),filter:this.data.attrs.type,linking:false}});if(!RightNow.Event.fire('evt_ItemRequest',eo))return false;RightNow.Ajax.makeRequest(this.data.attrs.prefetch_ajax,eo.data,{json:true,scope:this,data:eo,successHandler:this._prefetchedSubItemsReceived});return true;},_prefetchedSubItemsReceived:function(response){var items=((response&&response.result)?response.result:{}),showMoreLink,children;this.Y.Object.each(items,function(result,parentID){if(children=result[0]){this.prefetched[parentID]=children;if(showMoreLink=this.Y.one(this.baseSelector+' .rn_ShowChildren[data-id="'+parentID+'"]')){showMoreLink.set('text',RightNow.Text.sprintf(this.data.attrs.label_prefetched_sub_items,children.length));}}},this);},_renderNewItemGroup:function(items,level,parentID){parentID||(parentID='Base');var attrs=this.data.attrs;this._viewTemplate||(this._viewTemplate=new EJS({text:this.getStatic().templates.view}));return this.Y.Node.create('<div class="rn_ItemGroup"></div>').addClass('rn_ItemLevel'+level).addClass(parentID==='Base'?'rn_BaseGroup':'rn_SubGroup').addClass('rn_Item_'+parentID+'_SubItems').set('id',this.baseDomID+'_'+parentID+'_SubItems').setHTML(this._viewTemplate.render({url:attrs.landing_page_url+this.data.js.appendedParameters,items:items,imageBase:attrs.image_path,hierarchyBase:attrs.type.substring(0,1),showMoreLabel:attrs.label_show_sub_items,escapeHtml:this.Y.Escape.html}));},_updateBreadCrumb:function(level,itemLevels){var toUpdate=[this.widgetElement.one('.rn_NavigationArea')],topLevelTitle=this.data.attrs.label_breadcrumb,levels;if(level===0){if(topLevelTitle){this._hide(toUpdate[1]);this._show(toUpdate[0]);}
else{return this._hide(toUpdate);}}
else{this._show(toUpdate);}
if(!this.data.attrs.display_breadcrumbs)return;if(topLevelTitle){levels=[{id:'Base',label:topLevelTitle}].concat(itemLevels);level++;}
else{levels=itemLevels;}
toUpdate[0].one('.rn_BreadCrumb').setHTML(this._renderBreadCrumb(level,levels));},_renderBreadCrumb:function(level,itemLevels){this._breadCrumbView||(this._breadCrumbView=new EJS({text:this.getStatic().templates.breadcrumb}));return this._breadCrumbView.render({levels:itemLevels,currentLevel:level,disallowBackNavigation:this.data.attrs.limit_sub_items_branch&&this.data.attrs.show_sub_items_for});},_attachEventHandlers:function(element,events){this.Y.Array.each(events,function(evt){element.delegate(evt[0],evt[2],evt[1],this);},this);},_replaceBrokenImages:function(container){var placeholder=this.data.attrs.image_path+'/default.png',replacer=function(){this.set('src',placeholder);};container.all('img').each(function(img){img.once('error',replacer);});},_normalizeDescriptionHeights:function(container){var actionContainerHeight,tallestActionContainerHeight=0;container.all('.rn_ActionContainer').each(function(el){actionContainerHeight=el.get('clientHeight');if(actionContainerHeight>tallestActionContainerHeight)
tallestActionContainerHeight=actionContainerHeight;});container.all('.rn_ActionContainer').each(function(el){el.setStyle('height',tallestActionContainerHeight+'px');});},_setPaginationVisibility:function(container){if(this.paginationNode){if(container.all('.rn_Item').size()>this.data.attrs.per_page){this.paginationNode.removeClass('rn_Hidden');}
else{this.paginationNode.addClass('rn_Hidden');}}},_updateAriaAlert:function(text){if(!text)return;this._ariaAlert=this._ariaAlert||this.Y.one(this.baseSelector+"_Alert");if(this._ariaAlert){this._ariaAlert.setHTML(text);}},_focusFirstLink:function(node){var firstLink=node.one('a');if(firstLink){firstLink.focus();}},_hide:function(toHide){if(RightNow.UI&&RightNow.UI.hide)return RightNow.UI.hide(toHide);(new this.Y.NodeList(toHide)).addClass('rn_Hidden');},_show:function(toShow){if(RightNow.UI&&RightNow.UI.show)return RightNow.UI.show(toShow);(new this.Y.NodeList(toShow)).removeClass('rn_Hidden');}});